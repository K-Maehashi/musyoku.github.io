<!DOCTYPE html>
<html>
<head>
	<title>強化学習（1）- 価値反復 – ご注文は機械学習ですか？ – 自身の勉強用メモです</title>

	    <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="最近（というか昨日）、Sutton本と呼ばれる「強化学習」という本を使って勉強を始めました。

" />
    <meta property="og:description" content="最近（というか昨日）、Sutton本と呼ばれる「強化学習」という本を使って勉強を始めました。

" />
    
    <meta name="author" content="ご注文は機械学習ですか？" />

    
    <meta property="og:title" content="強化学習（1）- 価値反復" />
    <meta property="twitter:title" content="強化学習（1）- 価値反復" />
    

	<!--[if lt IE 9]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="stylesheet" type="text/css" href="/style.css" />
		<link rel="alternate" type="application/rss+xml" title="ご注文は機械学習ですか？ - 自身の勉強用メモです" href="/feed.xml" />

		
<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		TeX: { 
			equationNumbers: { 
				autoNumber: "AMS" 
			},
			Macros: {
				bold: ["\\boldsymbol{#1}", 1],
				double: ["\\mathbb{#1}", 1],
				argmax: ["\\mathop{\\rm arg\\,max}\\limits"],
				argmin: ["\\mathop{\\rm arg\\,min}\\limits"],
			}
		},
		tex2jax: {
			inlineMath: [ ['$','$'], ['\(', '\)'] ],
			displayMath: [ ['$$','$$'] ],
			processEscapes: true,
		}
	});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
	</head>

	<body>
		<div class="wrapper-masthead">
			<div class="container">
				<header class="masthead clearfix">
					<a href="/" class="site-avatar"><img src="http://static.beluga.fm/profile_images/225/feKPO6j83pM0/grande.jpg" /></a>

					<div class="site-info">
						<h1 class="site-name"><a href="/">ご注文は機械学習ですか？</a></h1>
						<p class="site-description">自身の勉強用メモです</p>
					</div>

					<nav>
						<a href="/about/">概要</a>
					</nav>
				</header>
			</div>
		</div>

		<div id="main" role="main" class="container">
			<article class="post">
	<h1>強化学習（1）- 価値反復</h1>
	<div class="date">
		2016年02月27日
	</div>

	<div class="entry">
		<p>最近（というか昨日）、Sutton本と呼ばれる「<a href="http://www.amazon.co.jp/dp/4627826613">強化学習</a>」という本を使って勉強を始めました。</p>

<p>今回は価値反復の章（p.107）の例4.3「ギャンブラーの問題」についてプログラムを作成しました。</p>

<p>ちなみにこの本は英語版が全ページHTML化されておりWeb上で読むことができます。</p>

<p>今回の範囲は<a href="http://webdocs.cs.ualberta.ca/~sutton/book/ebook/node44.html">こちら</a>です。</p>

<p>この例題の設定は以下のようになります。</p>

<ul>
  <li>プレイヤーはコイントスを行う</li>
  <li>コインの表が出れば賭け金を所持金に加える</li>
  <li>裏が出れば賭け金が所持金から引かれる</li>
  <li>所持金が100ドルに到達すればプレイヤーの勝利</li>
  <li>所持金がなくなればプレイヤーの敗北</li>
</ul>

<p>このような状況で、所持金を100ドルにするためには何ドル賭ければ良いのか（これを最適方策と呼びます）を強化学習によって求めます。</p>

<p>価値反復では動的計画法により以下のように価値関数を更新します。</p>

<script type="math/tex; mode=display">\begin{align}
		V_{k+1}(s)=\max_a\sum_{s'}{\cal P}_{ss'}^a[{\cal R}_{ss'}^a+\gamma V_k(s')]
	\end{align}</script>

<p>エピソード的タスクなので割引率$\gamma=1$です。</p>

<p>ちなみに<script type="math/tex">{\cal P}_{ss'}^a</script>と<script type="math/tex">{\cal R}_{ss'}^a</script>は以下のように求めます。</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{eqnarray}
		{\cal P}_{ss'}^a&=&P(s'\mid s,a)\\
		{\cal R}_{ss'}^a&=&{\double E}_{P(s'\mid s,a)}[r_{t+1}]\\
		&=&P(s'\mid s,a)*r_{t+1}
	\end{eqnarray} %]]></script>

<p><script type="math/tex">{\cal P}_{ss'}^a</script>は$(s,a)$が与えられた時に$s’$に遷移する確率を表します。</p>

<p>また、<script type="math/tex">{\cal R}_{ss'}^a</script>は$(s,a)$から$s’$に遷移した時に貰える報酬の期待値です。よって実際に貰った報酬$r_{t+1}$に対して、その状態$s’$が起こる確率<script type="math/tex">P(s'\mid s,a)</script>を掛けます。</p>

<h2 id="section">実験</h2>

<p>この本によれば学習結果は以下のようになるそうです。</p>

<p><img src="https://raw.githubusercontent.com/musyoku/reinforcement-learning/master/value_iteration/figtmp17.png" alt="実行結果" />
<a href="http://webdocs.cs.ualberta.ca/~sutton/book/ebook/node44.html">http://webdocs.cs.ualberta.ca/~sutton/book/ebook/node44.html</a>より引用</p>

<p>下段のグラフは学習完了後のもので、横軸が現在の所持金を表し、縦軸はその所持金のうちいくらを賭ければ勝つ確率が一番高いかを表しています。</p>

<p>これはコインの表が出る確率$p=0.4$とした時の結果です。</p>

<p>注目すべき所は、所持金が50ドルの時は50ドル全部賭けてしまうのに、所持金が51ドルだとたった1ドルしか賭けないということです。</p>

<p>練習問題4.7はこの現象の理由を考察せよとなっていますので、実装して検証しました。</p>

<p>コードは<a href="https://github.com/musyoku/reinforcement-learning/tree/master/value_iteration">GitHub</a>にあります。</p>

<p>まず価値関数の変化は以下のようになりました。</p>

<p><img src="https://raw.githubusercontent.com/musyoku/reinforcement-learning/master/value_iteration/value_estimates.png" alt="価値関数" /></p>

<p>これは本に載っている結果と一致しました。</p>

<p>この結果は、現在の所持金が$s$の時の$V(s)$（つまり勝率）を表しています。</p>

<p>今回はコインの表が出る確率が$0.4$なので、所持金50ドルの時の勝率も$0.4$付近となっておりこの結果は正しいと言えると思います。（全部賭けたら$0.4$の確率で100ドルに到達できます）</p>

<p>次に最終的に得られた最適方策です。</p>

<p><img src="https://raw.githubusercontent.com/musyoku/reinforcement-learning/master/value_iteration/final_policy.png" alt="最適方策" /></p>

<p>これは本の結果と微妙に違うものになりました。</p>

<p>最適方策は以下の式で求められますが、</p>

<script type="math/tex; mode=display">\begin{align}
		\pi(s)=\argmax_a\sum_{s'}{\cal P}_{ss'}^a[{\cal R}_{ss'}^a+\gamma V_k(s')]
	\end{align}</script>

<p>今回のケースでは2つの$a$が、演算精度の影響により同一の<script type="math/tex">\sum_{s'}{\cal P}_{ss'}^a[{\cal R}_{ss'}^a+\gamma V_k(s')]</script>を与えてしまったために上記の結果になりました。</p>

<p>そして練習問題4.7の答えですが、今回はちょうど100ドルに達した時のみ報酬が与えられる（つまり101ドルでは何も貰えない）という設定のせいではないかと思います。</p>

<p>50ドル全賭けして当たれば100ドルに達しますが、51ドルの場合は全部賭けると当たれば102ドル（無報酬）、外れれば50ドル（無報酬、ただし次に当てれば100ドル到達）になりますので、51ドルの時はわざと1ドル賭けて負けて50ドルにしないと100ドルに到達しないからだと思います。</p>

	</div>

 	
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//musyoku.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</article>

		</div>

		<div class="wrapper-footer">
			<div class="container">
				<footer class="footer">
					



<a href="https://github.com/musyoku"><i class="svg-icon github"></i></a>








<a href="http://beluga.fm/stark"><i class="svg-icon beluga"></i></a>
<a href="https://qiita.com/maxwell"><i class="svg-icon qiita"></i></a>

				</footer>
			</div>
		</div>

		

	</body>
</html>
