<!DOCTYPE html>
<html>
<head>
	<title>Recurrent Batch Normalization [arXiv:1603.09025] – ご注文は機械学習ですか？</title>

	    <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="自身の勉強用メモです">
    <meta property="og:description" content="自身の勉強用メモです" />
    
    <meta name="author" content="ご注文は機械学習ですか？" />

    
    <meta property="og:title" content="Recurrent Batch Normalization [arXiv:1603.09025]" />
    <meta property="twitter:title" content="Recurrent Batch Normalization [arXiv:1603.09025]" />
    

	<!--[if lt IE 9]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

		<link rel="stylesheet" type="text/css" href="/style.css" />
		<link rel="alternate" type="application/rss+xml" title="ご注文は機械学習ですか？ - 自身の勉強用メモです" href="/feed.xml" />

		
<script type="text/x-mathjax-config">
	MathJax.Hub.Config({
		TeX: { 
			equationNumbers: { 
				autoNumber: "AMS" 
			},
			Macros: {
				bold: ["\\boldsymbol{#1}", 1],
				double: ["\\mathbb{#1}", 1],
				argmax: ["\\mathop{\\rm arg\\,max}\\limits"],
				argmin: ["\\mathop{\\rm arg\\,min}\\limits"],
			}
		},
		tex2jax: {
			inlineMath: [ ['$','$'] ],
			displayMath: [ ['$$','$$'] ],
			processEscapes: true,
		}
	});
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
	</head>

	<body>
		<div class="wrapper-masthead">
			<div class="container">
				<header class="masthead clearfix">
					<a href="/" class="site-avatar"><img src="http://static.beluga.fm/profile_images/225/feKPO6j83pM0/grande.jpg" /></a>

					<div class="site-info">
						<h1 class="site-name"><a href="/">ご注文は機械学習ですか？</a></h1>
						<p class="site-description">自身の勉強用メモです</p>
					</div>

					<nav>
						<a href="/about/">概要</a>
					</nav>
				</header>
			</div>
		</div>

		<div id="main" role="main" class="container">
			<article class="post">
	<h1>Recurrent Batch Normalization [arXiv:1603.09025]</h1>
	<div class="date">
		
	</div>

	<div class="entry">
		<h2 id="section">概要</h2>

<ul>
  <li><a href="http://arxiv.org/abs/1603.09025">Recurrent Batch Normalization</a> を読んだ</li>
  <li>Chainer 1.8で実装した</li>
</ul>

<!--more-->

<h2 id="section-1">はじめに</h2>

<p>LSTMの内部のゲートやセルにバッチ正規化を適用することで、学習速度が通常のLSTMに比べて早くなります。</p>

<h2 id="recurrent-batch-normalization">Recurrent Batch Normalization</h2>

<p>通常のLSTMは以下の演算により出力値を決定します。</p>

<script type="math/tex; mode=display">% <![CDATA[

	\begin{align}
		\left(
			\begin{array}{ccc}
			\tilde{ {\boldsymbol {f}} _t} \\
			\tilde{ {\boldsymbol {i}} _t} \\
			\tilde{ {\boldsymbol {o}} _t} \\
			\tilde{ {\boldsymbol {g}} _t} \\
			\end{array}
		\right)
		&=\boldsymbol W_{h}\boldsymbol h_{t-1}+\boldsymbol W_{x}\boldsymbol x_{t}+\boldsymbol b\\
		\boldsymbol c_t&=\sigma(\tilde{ {\boldsymbol {f}} _t}) \odot \boldsymbol c_{t-1}+\sigma(\tilde{ {\boldsymbol {i}} _t}) \odot {\rm tanh}(\tilde{ {\boldsymbol {g}} _t})\\
		\boldsymbol h_t&=\sigma(\tilde{ {\boldsymbol {o}} _t}) \odot {\rm tanh}(\boldsymbol c_t)
	\end{align}
 %]]></script>

<p>$\tilde{ {\boldsymbol {f}} _t}$は忘却ゲート、$\tilde{ {\boldsymbol {i}} _t}$は入力ゲート、$\tilde{ {\boldsymbol {o}} _t}$は出力ゲート、$\tilde{ {\boldsymbol {g}} _t}$は入力ゲートの入力となります。</p>

<p>このLSTMにバッチ正規化${\rm BN}(x)$を以下のように適用します。</p>

<script type="math/tex; mode=display">% <![CDATA[

	\begin{align}
		\left(
			\begin{array}{ccc}
			\tilde{ {\boldsymbol {f}} _t} \\
			\tilde{ {\boldsymbol {i}} _t} \\
			\tilde{ {\boldsymbol {o}} _t} \\
			\tilde{ {\boldsymbol {g}} _t} \\
			\end{array}
		\right)
		&={\rm BN}(\boldsymbol W_{h}\boldsymbol h_{t-1})+{\rm BN}(\boldsymbol W_{x}\boldsymbol x_{t})+\boldsymbol b\\
		\boldsymbol c_t&=\sigma(\tilde{ {\boldsymbol {f}} _t}) \odot \boldsymbol c_{t-1}+\sigma(\tilde{ {\boldsymbol {i}} _t}) \odot {\rm tanh}(\tilde{ {\boldsymbol {g}} _t})\\
		\boldsymbol h_t&=\sigma(\tilde{ {\boldsymbol {o}} _t}) \odot {\rm tanh}({\rm BN}(\boldsymbol c_t))
	\end{align}
 %]]></script>

<h2 id="section-2">実装</h2>

<p>コードは<a href="https://github.com/musyoku/recurrent-batch-normalization">GitHub</a>にあります。</p>

<p>通常のLSTMはワンパスで出力値を計算できますが、バッチ正規化LSTMはセルの状態決定後にまたバッチ正規化を適用するため、二段階に分けて実装しました。</p>

<p>式(4)</p>

<p><code>
lstm_in = self.bnx(self.wx(x))
if self.h is not None:
	lstm_in += self.bnh(self.wh(self.h))
if self.c is None:
	xp = self.xp
	self.c = Variable(xp.zeros((len(x.data), self.state_size), dtype=x.data.dtype), volatile="auto")
</code></p>

<p>式(5)</p>

<p><code>
self.c = bn_lstm_cell(self.c, lstm_in)
</code>
式(6)</p>

<p><code>
self.h = bn_lstm_state(self.bnc(self.c), lstm_in)
</code></p>

<h2 id="section-3">使い方</h2>

<p>従来</p>

<p><code>
from chainer import links as L
lstm = L.LSTM(n_in, n_out)
</code></p>

<p>バッチ正規化LSTM</p>

<p><code>
from bnlstm import BNLSTM
lstm = BNLSTM(n_in, n_out)
</code></p>

<h2 id="section-4">実験</h2>

<p>芥川龍之介の羅生門を学習させてみたところ、処理速度は通常版LSTMの方が3倍ほど早く、収束も通常版LSTMのほうが早いというよくわからない結果になりました。</p>

<p>実験に用いたコードは<a href="https://github.com/musyoku/lstm">GitHub</a>にあります。</p>

	</div>

 	
<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//musyoku.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


</article>

		</div>

		<div class="wrapper-footer">
			<div class="container">
				<footer class="footer">
					



<a href="https://github.com/musyoku"><i class="svg-icon github"></i></a>








<a href="http://beluga.fm/stark"><i class="svg-icon beluga"></i></a>
<a href="https://qiita.com/jarvis"><i class="svg-icon qiita"></i></a>

				</footer>
			</div>
		</div>

		

	</body>
</html>
